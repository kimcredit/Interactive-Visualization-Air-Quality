<script lang="ts">
	import * as d3 from 'd3';
	// import { X } from 'vega-lite/types_unstable/channel.js';

	//resources: 
	// d3 rollup => https://d3js.org/d3-array/group
	// d3 line => https://d3js.org/d3-shape/line#_line
	// line chart example: https://svelte.dev/playground/3ad4a548a4c442b69f20c25021ac8fbf?version=5.39.6#H4sIAAAAAAAAE62d324dSZLeX6X2rA1Ihlis_J-hbTa8M-P1zcAGdseAx8O5OE2elo6H4uHynO6RTOjW935FP4kRVSWREr-IjxjvYC7UIj9VVWZGZGRk_DIfNrfbD7vN283v0vAvv-5uTrvh9_vb3fDb99v70_CfPm4_3N3sNm82P-9vdsfN2z89bE6f7vT39S82b76o__HubjzO8s2bzU_b4w79_dXh9rS7PR03bzc__N3Z2XB5Owz_9X7_bn-7vRnubg6nt8P70-nu-Pb8_PDTcXf_6_anm937fx2vDh_O_-N1Ov9pe392pe91HlX6m5vDu-HucDwNv-7uj_vD7aP8dLj9dL29fTf-dHN4d36dzpZ3OLvZ3-7Wf-Ly9uzsx8vby9sfjlf3-7vTj8NweXt52n-4O9yfhuvtaTv8fH_4MFxuxnP9r_F_Hg-3l5t_0Cevv6QNtbTT19_8-lfrV8-CH87XR8yPe1Q96L_7eTj_cfNmc9p9PG3enu5_2X1-Y7Tx9__2ty0Nfvq0vb--wde3_w_D9jhcpy_vfp3md9VfOD8f_nl3tdv_upt7ZWmM7XG4uz_cjfoLu4_zv3CzW372KPvD-90wN-9wvf-wu9VOOQ7b2-vhw_b-3V7_fBwOd6f9Ye7x-8Pd8ft_76_769P74WKQ2P_hux-93-3fvT8NF0OZpu9_tvz7fzjcDRdDNH76z6s8GT__zeF0OnxwfuH3u59Vn6fHD_7t_W572g2n97vh4_Dq_eF-_78Otyf9uMNxr9_5ejhebW9282deHW6Pp-Hjv-hfDBfDdRrnn_2309Ur_fGgf7P7qF32Spv1zfDq-vVw8eNwu_vr8LvtaffqerzennavX79Zfv1Pj6_1Zm24s6ff-mf9tdfwZT8Nr37d3Z_2V-6rfvr-VXWQbe_Xt_3T9EZ_8GH78dvXvR6vbg7H3es_f3nNtePOvmnnN4995rynGuzwbne7u9-eDvfj5e3F9-Z0_PWdyh7m7_88_3F53vznX_e7v_7m8PHicjMN05dfevyNjf7O8fTpZvf2w_bj2fzji8tNmKZ___Rny69fXG62v5wO-oPZjmYf9t_P_vHj_jjMvmQYfng3nO63t8efD_cfLi43859vtOemNw-wFT6_vtz8uDTTD_O3Hk_3h7_sLi43V7_c3-9uT7893BzuLzfDx3Dx8GQUng318_AxXnz5ovMfl9Ybhoe_322v3q-jbDztr_5yfPVa7U7_-Hn5nW_f_Q_6O1--4OubfPmPwXqlx1_Qd1ue90of8vrzkx9F80efwsXD9PS_48VD_frfjx_0_GWH329_2t18-8rqP4ef9zc3z5tOf3S2vb16f7i_uNx82F9f3-y0Rb97s-HTxUOMn398fKMH_cH4bnf6p19ubv6oA__x_X841392_eWHc23z-Wc_nL9b33x-6z8ub60u8D_f76_nKYOPlic9_fnN9DhE1r795Pftw9_vf57_Zvi7i4vhaRN_nXW__O_xncZv_v6_HE67t8M_7e-Pp8UE98fh-Jf93d3uejjub69Wj3e21Y_T77u5322vPw1397vj7vY0bE_D9PRffNJTz4bXCwbYl185O9xtr_anT2rOY_j2Nz5-N5yGR_P4anNzgz79FR2Dn_DwXAak8cOnoxM06x-fGJbdsHMXeQ37pVW3V6d55tzOkn_TdsWtdlb_zVpp-dPD-f7nz98Z9B-5QT_-U9CyH3_8rYnvbq-f_vD68GF_u709nWm0pG30xAs88VQXD2fy1B0Zn_W9fyAeYfXtTz54_tbHT3255zqetvenxXGdPRnP-qahPPqt__u__8_wu-3-5tMwT8PDq3_3en3S4ws-8VJ329P7L4-_PdyqZ_w6bo6n3e7mp5tfHv_ycYocy-VmuL540Aad5__Xyyz0w_nx13cvjGi_xtXfhrJP__pJDPunh0v90e5y8_ZyE6epnU35LKY_TNPb-f_jNE3_43Lz5nIzf_jl5q2kMebPb6Aue7oypmLoiqfrY7eeVz2djBINnfi6jmTlbAq-LDdDFx1dmKYxiSH0-kGFsF3K2eT1g-p6MITNFSajRcvZ1F1hGadqCL2uCFMdu9UZvrCNyWicMLnCPjZL6PeGjMn4xuB3RxuL0arBswv3Gz3D0FfNltAdAGEaJ-NVo9uqIYxi9GP0jCqENBbjVaNrVSGO3bAq17vpN1ZL6PZjSGO1Gse1jpANx1h8RxVCH5vhcpLbHTGMAX5j9X2cPhH2RiUuJ4YxJUPojvEYxwo_sZ5N7hiPaazWq7pjPOZxsp7odmPMYzYa1Xc5cTJ7I7i9EacxQauqZ8E3jjbCAVeJj9MBZwn9_p_MB_qdUcbJahq_M9JYoTeuZ8G1qRjGYryq7-JiGo039T1cNOzCdzYxGr6_-sFUCDJW6_t8gwqGQ61n0e_DaSxGV_h-McZxgt_YSEQVwxjhExuJqGIbA7T9RtxUioZhNOKmUhxh_zcS36TJcKhUGI3JphEvpULY_414qWQ51Ea8VGpjM77RD4xSH2F820hclPooltAd4vpAOPU34qbyZKjcPszJHG1-UKRCQ-faRcqG7TfiplIzLdF3U9lSuR2Y09ithvFbNIzZGGp-JJXC2OCrdhJJYSPsxLOlasQYnXi2FIyW6cxBlTFaQt8myjjBJu0kjlJ_Aa2wE9cWq-GhqND4QN89xTY243F-FKURptEyfhQVBIcYnfjD0MbJ-kR_zo_Gur2zKCqOETrEzqKoNhboojoJo1IcizFqfJ-YgjE9deYUC566O3FSKZoWRQKpOnarUalFwXVCJ24xVfNViVvsY4ZPFLJQzHkMcMQJi8Cq4YiFOzjsboQ5uGCsvoWFYHVsxhNJCFYM7y8sBKuG9xcegsERJ8TFpW6kGIWHYNkSur2RJyM3KTQEM7uRRGHTmIxX9X2cjnGjN3yPk_sYDavyw7CSxmAJXasq0Wwc38mVjBf8QnxcSTiLHiYST5WKF8QqdId46WNGr6pCtzdKwyNOhX5vVLyBokK3N2qwX9Ud47XhhY0K3TFe29iRV-XCioOjMBEfV-MIMyIqdAdAbXiuUqHbHbXi3LQK_e6QsVhC1ziakS1QoWsdLUGrUp3b_20aszFU_aiqZbypoULXqnrF87gKXavqZRSj_30f1-PYjN7wfVzPcFGsOrdRu5GbVKFrG914nB9SdRkFdn4gnrE3vNujQr8P24hfNRA_pZ0PuyKQWEyC4TUCicV6hbG46nzDKMZ0E5h_K2MyhL6bKgnHqSp0e6PKKJbQtahaxwCdf2COMVuNSvyisQ5XoT9NJXOI-6FY7Ti-DYGEYrWPMNOkQrc3WsD7kip0G6dFW-hPGhmH1Cr0bWPCa3EV-g4uj9HoR-LgjNV_iCSkat0INyIJqZoYjROZqyp4Ro3EU5neOBJPJYZRReJwJI_R-EI_oOrdGHCReCqZzM7wPZWEsRvf6HsqMSphVOj3Robb0qrzTSMaoV8knqonnPBXIZn7zW70PZUkI4SPJKDS8ilD51qGdHOE-45KOk7hqdA3DTHHjR8aSUf5Lc3AkwhHMiotW4R-o2YUpS5CP0qdUCp2Efqhf0P1DIvQD3ECWhctQneoNgFG9RJdR0VCs9D3VC2iyptFyKYNEPovQj_CEbTDvAj9vIiYveF7qjqhnbRF6PZ_DWglNgv9JVwp5quSxLigxPgiZIlx6039zcIJZWIXoZ-JdYR-YhxGcYuQ7aKDFc4sJInxYnRjZPuFcM93EfqtGlDBxyL0S69gQeMiJLtGhsrf3QgoK7YI_TKRgvYaZiGpuxKUTluEfslORpHRIvS3DA2XygKj2NAyZRH6ZUJ5rHCeYgFOtAY4C3BiQptUs5Ds_Fm2GFmJqJiNQwo2BZX6LkJWQwUS-IuQ7aeCNfwi9I1DUPS3CJlx4Mk4sVKogIpvFiEdctYTfX8D6ycXod-qkxGMJeZy4E7sIvQLb8WIVBJzOQ1VXy1C3-VUVDOwCFmVgsBBnpjPqWOFQy6xooFqjhxSRRUN15GYsxJUJLwI_Wk8jdEQkhBHxmJ8o-9zdJsS-tXECqIgQrEI_ZqoyRzkvs_JyYiqEolxMtql6Mrd-CFOtho1k2VcbobnyGwLLxhjPLMtvGSsODNxOaUY8X8mUU6JxlI1E19VAkr_v0SYUSX0LPSdXG5jMJ7ou5zcjHVcJmFO7qgQfhH66zhUELno2Pa2NeLoMg6vODPPVIMNtUXo74tOoIRj0fn7DRCg6RQP1DfFMw7hA3U1jieOTDxVi8bSIZPoqBUjG0MQQd2IBcmxTiHB0J8X_HaOCPbJaNLC0tvZaNLC8tsV8ROdM4I9jgUOG8YIdmuCY6hfT8YyrpCYqlsmVUhM1eFWXOeMYK-oHLpzRrBbpsEYwd6MaLzwDLf1pn5vFFCj2jkh2DqCoDonBBssbu2cEOwBwR6LkNkGKBZfhL5tNCOiYoSgWqPVOH5vQGCrzzAbrd8wdKx8A-yLd04I9mL0PyMEuxi9wQjBbiVGK3M4VtRIhfYTyR4eJLY7JwRbMhwOIwRbNPvRdzitGnFqZXt4EMHonBFs9hgnLm7Croohgq0Yq8bKigaSMeFUElJpNxqf6IdUraEd1c4xwdrNgUPKFCZUFbUIWakhXqc0ElK1PFYY_DNMUENqS-h3x4R2fxehP1SLMQAa28QTYy3GcL-WjZFDhdXIHDNOUAtcjFYlu3gJnfWwCNm6AbtVxgm2aLhVBgq2YAv95V8xMseNLf8qqsVZhP7yLxoJYMYKVitWZbBgESNVyWDBGk2zIkXjqPxj0fk5lWZkcRguWMQcqn5qrMCiis5xwWKtxzrPVIF66kXozwCTYVWMGKzZiOQYMVgTKhzpnBislnfszFclhKYvQn_OsXLcDBpsAsq_OmcGVQdtgzGDrRibXJ2FVcUIHTorNk9GGpdBg60YoSODBhssVOwcGmyQUliEfqtGc8SR8k94LEnn1KBGOYZxkORYMgeA7x2rlY4XFldVwwEIiauUxIDmyKjBGlDBaefUYJ2MEFBYOh7CP53Df7rlYD2RCmHMwajBEo0CEEYNZiuRKywdPxmVI8IObrDmVYYNxoZKBzvHBhWNNcYqxQbxjrwwUDkY-SohAVm0VtYMG4wd8aadY4MpGBvrDBuM3UjIC_E5UzGCTmFHYcHzfjrnBifBQSflBqcJZsgYNigNV9Wpzj3NsONNNdV5I7wLXnIyZlAzzsgwGPnX4fl5XCcVlCnPMnKU1YRHjAr98_ogFN8pLygNh_AUF5zgAUqd4oLS4OpGZW6DdpxPUTzNmy8k4K1NxgpqBxoD2_Vr0vEChZGCUvGer-rc5ozY46vOMyQxSrAoJzgZ--iUEwzGXjFFBfVESfiJrKx9MgKwwMrawzSK9UTfKBJcDzFSUAQ7X1JFL8a8xHA_KTguCaSkXTLC5zulBMVIMDJIUKph86SCXiazXVzX1K1JiVSzd8uWCCHYjSwYAwT7ZPg0wgd2I5cZSAm8RGOOICXwilwZMveEZOtZrglZIteA4HGcfcbXvAHdO44kVecO6Ij43E5JQsG70Iwj1LkPjktSKw-XSYEUrouMDRo5QwH1L6GXJkL1fsbX-V4MjhRSJK8PM3rOD68y3s1TnW8DePuQsYNmfEzYQWvbmaGDggqAAqlx70YST3We-XQrRiLQoNbiWM_zOs_TeZ3XC95PCaS8vRs1yqpz5wNrHiGkYYdH2MvMxJH-M3Wu-5uQMSw63x-heWvRuXNCQptFQulECaiwRSicKBGUXwpFDGUyP8_1Sb2jJMGic82ooQSKUDBRu_25jxDKJfaEzFYoltij_TyvPVsHJaKzjEVHIOkmFEnsHaUHhRKJns5tFrg_vOhca5jQJo9QHlFRfUPmGoP1LGIKAepYYBXQcYmLjkW2cGiyyCqhRbBQClFXNLDPI10gguBq0fnBFTxHkgsFZqCFUogCD3UUCiGKoPhKKIMoMN5ZdG6DZrQbtOiIMYBCMqEEosDtZ6EAogRsfDxSAmHuomMrZ0tHVhpWNzBfBvbWhKKHXdBhhTKjbmTqA4sbofyg-mrY7QQfFFiUK5Qe7PCSIKHwYEeHuAolAPX8D6s5SXYcVFUJBQd13Q3dLuEGNUkKhyfBBgWewrbo2CoMmh-BBkWMyIwxg1NAl-cIZwangArjhTOD-kRogYns303N_EZ__26qgKcTzhpO8LBw4azhJCiVL5w1nOA5s4vQb1TIUwlnDaeCMqXCYcOpo5J64bBhiMZigMGGoaAc-SJ0WzXAE0qFw4ag1FA4aRgqKjUSDgwGQfVb_39CAjfDo82Ek4ahG9MhIw0DPIZHOGkY4dmtwlHDmAyXmtlJDOjOHeGkYYRXGggnDaO1pmCooZ7gYej8wgZ05Y7QiwH1pAG8sGOgofNAdgoD2CcRzhnGYqwqGGcYG9rREX45YIqoPkE4apgsv8hQQz2539CxMzFAGlw4aRitGJrdDRgtP8VIQz3aAtowIw31bBPrVX3TgDtQwknDGO1XZbcTgDIz4aShHm5jCalxGN1BPFxGVX_CWcNoDlU_oEoTAtuFo4YpoWIx4aih3mpgtY1_JBZMxQu_GjCJsdSo7E4ba4wz1lBL8Kwn-vWJsCRWOGuYYRGu8LsB8cVEwpHBHI08FhVaiQnGGiZ4sqlw1jDVUYzG8V1OqqgiRzhrmKzVLWMNUzE2EBhrmGAhiHDWUAe5ISTlos1IpDDYEF-jJBw21EtfjCFHykUFHYsmHDbMEZWtCL8hMAdzyJH7viLavRUOG2Zrz4PBhhlenSscNvSE7CoVsDkqnFJMRjjOIEW9LMZ6U3YhDt7YocJuZH_Y1YIZXp8pHFLM0Ui7M0gxw5ushUOKGV4PLRxSLMHYPGbXC5aIqrOEQ4rFWgAySLFUY0JmkGJpxu7JCyBFnIxhVwxWVPYtnFGsz-s-hBOKdUIspXBCsUZUvi2cUKwJYV_Cbxis8FQM4YRiLcbWICUUi5GEp4QiPEtbXkAoFmOAsxsGazbCOAYa6j0TxhPJdRHdWMcx0lBv7oGOil0WWMRIjDPSECfUGGZYMzigRjhlqLdTGOOUINhiTG_sosBqJSoYZVjRcbHCIUM9SsEYNMS5wRNx5QWQITzWXPhFgRXWJMqMw1HDMHS-XRRj7f8COBG7KQYnNnhPnHDGsEVjE46hgi0Y6UYqjIiHFs4YtmhsZ7OLApVOhUbFGEN8lIZwxrAHI2vEGMMOOQ7hjGGHZ_AKvyiwZ1von2yWjdUmYwzhdSjCEcMOT30Wjhh2eM6Q8IsC9YAq61XZOXO4uI4hhlYRJ0UMO7xIRThi2DPcbqD3BPaKxw1jDPUCFpgzYJBhsMpg6M2E3ShjohcMyoTIAOH3BAo8S0s4aSjGQpyShlqSZPSj7-O0ztUYOMTHdTwd04sCu5HCYbChXsECNw0ZbRinjEB6obhhVFTY0HndGKeEK5rYPYFxitipMuAwiJHCY8RhUPrF0Lm9aFX98JsJO3T__KZAo7qMAof4fELhwKFpxQw4FHj5urzgbsKMU0aMHYxTwCWsXGjU2jLqUIc49sakPl5fFWZFGHeoVgwXDuyuwDjBY8aEkocR7m4x7lCdBgBchYKHcZrwyp9eTajYMPRTpNhdXxUmDBl7OPeFMVDdWEyFcF-c4Yeu0O_ECacM6A2DGMYWyiGqa4Q7BgxEVCHA1IXfaagV7LAf2cU9knAdFr1isMNDxoQCifPsbzWO3x0NcKsv0Rk5Q3qpoRgbsfyKQXjZs1AsUZ8IC5MZlxikGBMOu9RQr1GEvordaohRSHnBHYPwKAaheKLaMdzAYXyiTnGGGRMfBy9uEwooukJ35gjw-CWhiKI-0dK5s78-0HhTN6UWA8KW5kWq7xtdoduoAW01r0J34ggZrMVXoTtx6HkTz6xxFfrdiNDBVeh2YwjAcSxCPxgLE9ilWIW-UTWQGluFrlGFCVRirUJmVc8dxyr0rQrhAquQxmOW0O8ORBqvQmZWVquShWoHFVWr0A85GljjrEK_VdElM6vQj8cKWOKuQhJUg5hzFbKrW5-nOFahv1SNYG9kToyxQA7V8K5CP5ArYFpdhX7oIGB2XIV-6BBBNmYVstDh-cpxFfqtmgEVsQpZQPY8kn-REHEYi5BEch1EcquQxhxwrJJIzhX6ZpWep2NWnW9V6LDQVeh7R7QBtAr9mCOYjUoDuee7xqvQt6pm2jGJ5CZARa1Cvxut92RL1efY13xmHwmOpg5SI6vQD3E7KP1chWw2fr5RvQr9cGwClfir0A_H0MJxFfqzsRgzFcEhY0QHTrxIiG7uXoR-OBbBDteqc_tfy9sNndsZeh-q9aJuZ0SUUluFrruJlvMnLKUKcdxIWMoI79FchL67ieiwn1XoGlVER0GsQteo9FJj6BkJTBkh3rAK3X5M4JaRVec2aoqgEGsVuqaR0DHai9BfOD7fM1AVASn1cXgpRkBKV-i3aAfAwCp0LUNv7YQtQ0DKmCds_ASljLCWfhW6fZgDKN9bhL6b0vpUS-j2BqyIXoWuReUCQNpV6FqUHi8N_RRBKWMGB6KuOrc3Mjp6dxX6vZFBmnoR-mvGgkrGVqHbjVpMabyq7xjbBOrTV6HbqHrau6FzbUrvFzF6w0-o1WDZlO8Xawd5sVXo9qJevQl7sZBArKLt1FXojvDSwakNq9DtjFKMZBNhKWOuxkxMYMp50oDdQW5fjCUZcTGBKWOpoK59Ffq2gQ7wXYWubRQraCAwpX7j8-qmVeh2R8mG_ROYMpZov6rv4zrYpV6FftTQQAHHIvR9nKIUxjf6oViu9hP9iaOYrer7uJyNVCzBMHUAWB7Ad3IFUR-L0I_FTCHBMGO1JoBKwrGKrrRdhb57TMZ6g2CYs5eDA6ASZ1XQdbir0LcOa0lNaMqY0_Nio5foCiobWITEOyZb6PuqPEZj4PjhWBEjjiMUZqzNmHMIhRkbqsRdhW7_t2wEcpX4Kr24zxK6VtUQv7sKWTyGFzmEwoxWX_iuUeENQ-cHY_15Nf2qcw2qVLtBfcMI4Dg5FRIAUye45-UUq9Bf4FTDaTQSjHlCPxhDh32tQt-_oXNKV6HfHd0IjQhIORs_dHCNBGOlGe6GEJg6ACyd79-ise9DAEx9IM6nEQBTJw2jTUkohiDzVchs4_lFIYuQLDczOPRlFfq9KEYalvCXKrRsww_FdGVsNA5Zb6JrW1ah7-ImI9ogDKYaFY4aCYM52wYccZ2FYsGYbQiDqUK8YUQYTF1T4QUnYTD1idD_EwRTewN7KkJSzg-02oa5uOdQ3CIkodhk7IkSdlPtGCfxCLupHsd6U5YYw6kRgm7qm-IohaCbGqbiSIzQm_qJeH1D8E0VWt_ou6pc8IRD6M05h2vYFFmmRsONE3xTs83YNxJ8U7PGeBbvxFNlcK7RovNXqTnhgUrgTTUpvA4j9KbO_jjeJPSmOvHnN_GsQt80HKFvGg0QCqvQT3BGIy9O6E1diGNjfIEQu0Yhjqo2I_lLsE9db-ByAYJ96noK534I9hlbBWe3rUJ_lVqMHUMhnqqjm5cXoR_G9WQOOT-M61alGcE-Y7e2Ygj3GcVK_glxVfD861XomlWvRqKacJ_aOFY_-s5RuwO1aiDcZ9Tbo1DjzJsV7pAztjgCAT_nfrSEbnfAY8VXod8dxg5XIOBnFCOHM__fFRacGmfgZ5SOd38Z-Jn0pk9L6FlHmiLA4lahNwBSyOA8nFXodUd6frTBqvL6Ik3oBL5V6JlG0mpq5OIY9alPtEzDdXFpanhjVIVuk07ogPhV6NmUCmH1JsM-9VVhJp5hn0nJVutV_X6c8CoukMr_NKEDMVehbxpiGCMBP1OIMBpn3GcK6FqxVeh2Y2jgopRV6DZq6DioZvhmChVnKriwA2JoEbquUZ8I84aM-5zHuPVE36qMAJBxnwmeor8KfasCp1qvOt-oOq5vYeRnmipOOAZS959CMm3Djcb0Vc0n-kaVLaPyXdzzgzRWlW8Y6MLfVeiP7wCO7phnYeKmQoWFP4zdVIMyH-g3aAMo7Sp0R2mc7CeSCRych7QK3d6I6Aq2Vej3huBteCqM6HSKRejHU9GoTmfwpj4RFrcxeFOF2BRJyb--KkzhMnhTn_gcF1yFfqtGcwD4IVUEt46tOteoIjpIaRX63ZhgAVcgNxHpi8KqKIZg6pvi2I8gmCq0xo3vqfQTjW90E2Pai8A2wowZ-kMcHTG_Ct0hntAhM6vQHeKgXChQADOlhOaoQAHMlCqqFgn0zsekBapGk_pRUUYg7Sp0LSOjU_tXoWsZWhL7fIQHCmCm3NHmdqAcZcoQ-QyUo0wJLosC5ShTQjdSLULipyoCMBeh2zgJ3ROwCl3TyAGEDYFilAke2r4KXePQaqHnPjxQjHI2Dqzz3Y2evQ_blEVUGR1OsAr9IZ7tJ_pDPKGQKlCKMmVwC9aqc9tUd9PhQGURVQEHTK061zJ0vxg6KirMKEEVKEOZCrp2axW6nVEErfsDZShVCCcbFk9praAx3vx4qqACpUARylRgkBooCZng6emr0LeMiPIFgZKQKrQGKvFv9oDz3U2x_BSBIVNG532tQrdxdP8ONg6BIXXA4X4kMGR6fu72qvJbBiaZAyUhVQhWU4ECjdoyILh9gTBXtJoKlIRUxwgq9xeh3xfJ7Avfa2R0MM0q9GNUdC7lKvTD1GzEfoSF1CdareqHNzoVGzrfpMC9tavOtagEd24CJSF1Bgc1H4GSkDpu8DSVmLuZjKmfoJAqBKVbgaKQCVdgBopCqhCUXwdKQ2qrYtvILLwJRj8SGnKO4C2hbxsd5W4DpSFnIZyoCA6Z9FIqo3F8V5UmkNgMlIbURYrxhf4CTuNwOG4IDDk_EJoxgSGTXoJmNY3fGbBWMFAaUpdTYCM9UBpyXogbtuG7xjKBWsFF5zucZHh_wjTODsfoDX8BV2D6NlCoUSdjUCsQKNU4PxGOuMIWYhUViwVKNaqLg21DoEaN_XCGikCNdtsQqHGOcOBIJWxi0nrIv0mHrkFYhCTV1FDJT6BM47y4NRqVpJrQdtii82eNhMMUQjTOnhG6VEI0apwCdosCJRrnL7Re1c9QQUxwFpKQKuNZgwCN6vzxFE6ARm3U51eurEK_F42-971bQteDLEISFcGKhkChRA38cThVuXezdH9blqn-rUERYRK1802hPw9HVO0RKFuoMz-o2nmBMBacvKls3w4dgRMokjgHRcYXkqDImjEIkmjsaQWKJM47jJbQ30UtRj6UIIn6qoZJkW27aOSnCJE4bxRZT_S3puAxCIvQtynbNEg6vJi94UdTevel9UQ2Z-BlP8ES55Q_fFVCF86xBuwOQhfqMhxnmghdmBRLMnR-iCroWLFZSBJNsCsIWahRPzZ-QhZqqhjAbIGihdowoO46ULQwVXSHxSp0u0KxYkPndkWzEv4ELUy9YtdPyMLUm7G7TMjCJEac2UhIJOAmilXnmVOeIMoQKFeYJKKCtEC5wqTHdBud7zspvcEG9n4nvkasaZFwhUnLw2HjEK5wbhxoGYQrTA0W3QfKFapl4F2UzryUtadB-MDU4CHWLxDWhA5OCBQs1G802sb3jK0aiftO_FS3jIOAhanbQ9WPp7qV8iVgYaoVVV0HChbqXije0e7EU5VqvqofUDVUBxUoWKjdiDdfCViY4J15q9DvxoSI9EXoNmoXY6-AgIWz0Biq_lKzZ2OpSdDC1IPR_wQtnO0fjjhCCKYmCNYIlBDU7gBkaaCEoDYOTsIQ0E_dMbZjYS4Hcv6BEoL6qtiPE0JQR47RNr6Pk2jsFRFAMMPC8kXndUbWexqsN_U6I4dkZBkJH5hDNLvfdXF5skIVwgfmKVudQaMxgOsGigcmPWvd6EUSjTVjFid4oEZjOMQheKA6HLjyVwLO9__gAuNV57t_BGsHCgem1lEtc6BwoBnEMTgwVYHLm0DudtQ4FaDTgbKBasNwmcLYwDwZqVvGBmaMlQTKBmaYmlaV1xU5GPMpAwNzNLKMlA0UiD8FzgYKurl8EfprTYl4p0CFbpNOBa_fKRsoxsKfsYE63gwTdt2b-lO4ZGBooArBIX2z0I2nVAi3GAJDA6Xi1H1gaKAYuwyBlMDrpAHI4EDZwNn64RhnNekiuJg9EDYwT-hSuFXIjAPu2lJhNza1KBtoBWKB1aQ3YyqmbKB6caNxyGozG-bI2MBmDzmSh8s4vA2smL0KDjcoHNhss_JXm9VY_LPbHTVNAQOcwIrSm0FsUECwoUMzA-cDe8Q6VszeG15PUT6wC0zEBHI_jyY3ce9HElHJZLhxVszeBR2bFTgeKPCalcApPzEScYHczzPnRaFNMTzQjP5YNXuHB3UFjgc2eGxG4HigJhusxvFX8JDyCxwPlGKOHBJVGektygdqJt56oh8aJyM0JoCgzqqw4oMBghrFw2pfBghq5IhdHAEEM8gYRQr5acoAhA2RQn5zyuD5B0YK-WV8pECknJ-uG6wHug0TAwqpXiJMKIiLFPPTNwXjNFLMT18VXLQSKeanizHgqBah36gZzDeRUn45CjqJMlLKL0d4MFSklF9WcBrrfNuPMBKLFPLTB5pC1zRwkWCklF_OGeXvIqX8coZH3y5Ct1FxPWukmF8u6CrpObrxIyMVgpkxUswvF-gYI8X8sh4obL2q26p6DD00DhIa5QqXG5FyfrlV-1XdfhSY3XyZENQlz0LX4xSd4Ayd1xtFD3iyhK5VSUP1MJGCfvqmIMCJFPRToTXi3ACn6OEn0MeRAKeEhIqFIiX9SqjGxEFIvxJhBf0idBsnQrosUtKvpGI_0TOOkmHtXqSIYFF4Ho4cggiWXNC2aKS3F5aUUNHfInRbNcGiv0gpQRWCNF6klGDJEL2LFPabG8doVTfIKeC0tUXl9kXtoPw2UkKwdEEbzZESgqUXhE9FSgjOQqthvK6oUzA_0euJOsHLSyIFBOuEtm8iBQSLCLrZJ1JCsAgspYj05sI6VXSc3CL0DKqGbMQphBCsoaFkQ6SEYJ0EwUyREoLaqnjVQG4vrAGihYvQs40a4VkNkRKCNWa0oRIpIVhTMgIccgthTTC9_QJh7MasQUC_GitI_UUK-tUYUco4UtJPzdj6ROJwILC1CF3jmFCyMVLQr07wZq9IQb_S4SFmkYJ-pcFLASK9hLA0dCnAonOnjQoPPo-UEKzhOeQfKR5Yp2a-pt-DRr_7nkarfeDHFRJJ9agj7c-bN5vT7uNp8_Z0_8vu85_fbE7b_c1f97fXm7c_b2-Ou8__D-Xbnal1KAEA
	
	// d3 ticks => //https://d3js.org/d3-array/ticks
	// d3 time => //https://d3js.org/d3-time-format

	// tilting axis => //https://ghenshaw-work.medium.com/customizing-axes-in-d3-js-99d58863738b


	interface Item {
		city: string;
		country: string;
		mainPollutant: string;
		pm25: number;
		state: string;
		stationName: string;
		timestamp: Date;
		usAqi: number;
	}

	// properties this component accepts
	const { data }: { data: Item[] } = $props();

	// chart dimension variables
	let width = $state(700);
	let height = $state(400);
	let margin = $state({top: 40, right: 20, bottom: 80, left: 40});

	let usableArea = $derived({
		top: margin.top,
		right: width - margin.right,
		bottom: height - margin.bottom,
		left: margin.left
	});


	// just for debugging; can be removed
	$inspect(data);

	//Colored AQI definitions
	const aqiLevels = [
		{ name: 'Good', min: 0, max: 50, color: '#9cd84e' },
		{ name: 'Moderate', min: 51, max: 100, color: '#facf39' },
		{ name: 'Unhealthy for Sensitive Groups', min: 101, max: 150, color: '#f99049' },
		{ name: 'Unhealthy', min: 151, max: 200, color: '#f65e5f' },
		{ name: 'Very Unhealthy', min: 201, max: 300, color: '#a070b6' },
		{ name: 'Hazardous', min: 301, color: '#a06a7b' }
	];

	//grouping data by months 
	const Months = $derived(Array.from(
		d3.rollup(
			data,
			//calculates the mean of AQIs for each month
			(v) => d3.mean(v, (d) => d.usAqi),
			(d) => d3.timeMonth.floor(d.timestamp)
		),
		//sets the mean to the 15th of each month to give better spacing
		([date, aqi]) => ({
			date: new Date(date.getFullYear(), date.getMonth(), 15),
			aqi
		})
	));

	let xScale = $derived(
		d3
			.scaleTime()
			.range([usableArea.left, usableArea.right])		
			.domain(d3.extent(data, (d) => d.timestamp) as [Date, Date])
		);

	let yScale = $derived(
		d3
			.scaleLinear() 
			.domain([0, d3.max(data, (d) => d.usAqi) ?? 0]) 
			.range([usableArea.bottom, usableArea.top]) 
	);

	//line generator function using typescript type specification
	const line = $derived(
		d3
			.line<{date: Date; aqi : number | undefined }>()
			.x((d) => xScale(d.date)) 
			.y((d) => yScale(d.aqi ?? 0))
	);

	
	
	let xAxis = $derived(
		d3
			.axisBottom(xScale) //position on bottom of x axis
			.ticks(d3.timeYear.every(1)) //show 1 tick per year
			.tickFormat(d3.timeFormat('%Y') as any)); //format ticks as YYYY dates
	
	
	//positions y ticks on left of y axis
	let yAxis = $derived(
		d3
			.axisLeft(yScale));
	

	//positions the y grid lines to be the full width of the chart & removes labels
	let yAxisGridLines = $derived(
		d3
			.axisRight(yScale)
			.tickFormat(() => "")
			.tickSize(usableArea.right - usableArea.left));
			

	let xAxisRef: SVGGElement;
	let yAxisRef: SVGGElement;
	let yAxisGridLinesRef: SVGGElement;

	$effect(() => {
		if (xAxisRef && data.length > 0) {
			d3
				.select(xAxisRef)
				.call(xAxis)
				// .selectAll("text") 
				// .attr("transform", "rotate(60)")
				// .style("text-anchor", "start")
		}
	});

	$effect(() => {
		if (yAxisRef && data.length > 0) {
			d3.select(yAxisRef)
			.call(yAxis);
		}
	});

	$effect(() => {
		if (yAxisGridLinesRef && data.length > 0) {
			d3.select(yAxisGridLinesRef)
			.call(yAxisGridLines);
		}
	})


</script>

<div> 
	Show Raw Data 
	<input type="checkbox" />
</div>

<svg {width} {height}>

	<g class= "grid-lines" transform="translate({usableArea.left}, 0)" bind:this={yAxisGridLinesRef}></g>
	<g class="x-axis" transform="translate(0, {usableArea.bottom})" bind:this={xAxisRef}></g>
	<g class="y-axis" transform="translate({usableArea.left}, 0)" bind:this={yAxisRef}></g>

	<path d={line(Months)} fill="none" stroke = "black" stroke-width="1.5"/>
	
</svg>

<style>
	.grid-lines {
		color: #D3D3D3;
	}
</style>


